@import helpers.AgeHandicaps
@import models.BallColour

@(courseClass: CourseClassType, comp: PlacedCompetitor)(implicit request: MessagesRequestHeader)

@numberedPunches = @{ comp.competitor.punchResults.results.zip(LazyList from 1)}

@main("Detailed results") {

      <div class="col-8">
        <h1>Detailed Results</h1>

        <div class="alert alert-primary" role="alert">
          <h3>Course - @courseClass - @comp.competitor.name</h3>
        </div>

        <table id="summary_@courseClass" class="table table-striped table-sm">
          <thead>
            <tr>
              <th scope="col" class="left">Pos</th>
              <th scope="col" class="left">Name</th>
              <th scope="col" class="centre">Club</th>
              <th scope="col" class="centre">Age Class</th>
              <th scope="col" class="centre">Controls</th>
              <th scope="col" class="centre">Time</th>
              <th scope="col" class="centre">Time Penalty</th>
              <th scope="col" class="centre">Punch Points</th>
              <th scope="col" class="centre">Age Factor</th>
              <th scope="col" class="centre">Final Score</th>
            </tr>
          </thead>
          <tbody>
              <tr>
                <td class="left">@comp.place</td>
                <td class="left">@comp.competitor.name</td>
                <td class="centre">@comp.competitor.club</td>
                <td class="centre">@comp.competitor.ageCat</td>
                <td class="centre">@comp.competitor.punchedControls.numberOfControlsPunched</td>
                <td class="centre">@comp.competitor.raceTime.timeTaken</td>
                @defining(if(comp.competitor.scores.timePenalty > 0 )s"-${comp.competitor.scores.timePenalty}" else "0") { penalty =>
                  <td class="centre">@penalty</td>
                }
                <td class="centre">@comp.competitor.scores.punchScore</td>
                <td class="centre">@AgeHandicaps.getHandicapForAge(comp.competitor.ageCat)</td>
                <td class="centre">@comp.competitor.scores.getFinalScore</td>
              </tr>
          </tbody>
        </table>

        <br>
        <div class="alert alert-primary" role="alert">
          <h3>Control breakdown</h3>
        </div>

          <table id="details_@courseClass" class="table table-striped table-sm">
            <thead>
              <tr>
                <th scope="col" class="left">No.</th>
                <th scope="col" class="left">Control</th>
                <th scope="col" class="centre">Colour</th>
                <th scope="col" class="centre">Scored</th>
                <th scope="col" class="left">Explanation</th>
             </tr>
            </thead>
            <tbody>
              @numberedPunches.map { case (punchData, num) =>
                <tr>
                  <td class="left">@num</td>
                  <td class="left">@punchData.controlCode</td>
                  <td class="right">@punchData.ball @punchData.ball.getBallImage</td>
                  <td class="centre">@punchData.score</td>
                  <td class="left">@punchData.description</td>
                </tr>
            }
            </tbody>
          </table>

        @helper.form(action = routes.ResultsController.resultsSummaryDisplay) {
          <br>
          <div>
            <input type="submit" id="toindex" value="Return to Results summary" class="btn btn-primary"/>
          </div>
        }
      </div>
}
