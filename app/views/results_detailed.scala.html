@import helpers.AgeHandicaps

@(courseClass: CourseClassType, comp: PlacedCompetitor)(implicit request: MessagesRequestHeader)

@numberedPunches = @{ comp.competitor.punchResults.results.zip(LazyList from 1)}

@main("Detailed results") {
  <div class="container">
    <h1>Results for @comp.competitor.name</h1>

    @helper.form(action = routes.HomeController.resultsSummaryDisplay) {
      <fieldset id="results_detailed">
        <legend>Detailed Results</legend>

        <div class="resultsblock-title">
          <h2>Course - @courseClass</h2>
        </div>

        <br>
        <h3>Competitor summary</h3>

        <table id="summary_@courseClass" class="data_wide">
          <thead>
            <tr>
              <th class="left">Pos</th>
              <th class="left">Name</th>
              <th class="centre">Club</th>
              <th class="centre">Age Class</th>
              <th class="centre">Controls</th>
              <th class="centre">Time</th>
              <th class="centre">Punch Points</th>
              <th class="centre">Penalty Points</th>
              <th class="centre">Age Factor</th>
              <th class="centre">Final Score</th>
            </tr>
          </thead>
          <tbody>
              <tr>
                <td class="left">@comp.place</td>
                <td class="left">@comp.competitor.name</td>
                <td class="centre">@comp.competitor.club</td>
                <td class="centre">@comp.competitor.ageCat</td>
                <td class="centre">@comp.competitor.punchedControls.numberOfControlsPunched</td>
                <td class="centre">@comp.competitor.raceTime.timeTaken</td>
                <td class="centre">@comp.competitor.scores.punchScore</td>
                @defining(if(comp.competitor.scores.timePenalty > 0 )s"-${comp.competitor.scores.timePenalty}" else "0") { penalty =>
                  <td class="centre">@penalty</td>
                }
                <td class="centre">@AgeHandicaps.getHandicapForAge(comp.competitor.ageCat)</td>
                <td class="centre">@comp.competitor.scores.getFinalScore</td>
              </tr>
          </tbody>
        </table>

        <br>
        <h3>Control breakdown</h3>

        <table id="details_@courseClass" class="data_wide">
          <thead>
            <tr>
              <th class="left">No.</th>
              <th class="left">Control</th>
              <th class="centre">Colour</th>
              <th class="centre">Scored</th>
              <th class="left">Explanation</th>
           </tr>
          </thead>
          <tbody>
            @numberedPunches.map { case (punchData, num) =>
              <tr>
                @defining(s"images/${punchData.ball.toString.replace(' ','_')}.png"){ ballImage =>
                  <td class="left">@num</td>
                  <td class="left">@punchData.controlCode</td>
                  <td class="right">@punchData.ball <img src="@routes.Assets.versioned(ballImage)"></td>
                  <td class="centre">@punchData.score</td>
                  <td class="left">@punchData.description</td>
                }
              </tr>
            </tbody>
          }
        </table>

      </fieldset>    @helper.CSRF.formField
      <div>
        <input type="submit" id="toindex" value="Return to Results summary" class="btn btn-primary"/>
      </div>
    }
  <br>
  </div>
}
